<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Pablo Morelli">
<meta name="description" content="Devandchill is a coding and tech blog oriented to go, .net and databases made by Pablo Morelli" />
<meta name="keywords"
    content="blog, development, programming, tech, postgres, array, aggregations, query, json, performance, optimization" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://devandchill.com/posts/2021/03/reducing-loading-times-by-a-tenfold-with-postgres-aggregations/" />


<title>
    
    Reducing loading times by a tenfold with Postgres aggregations :: Dev &amp; Chill  â€” A blog about coding
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" type="text/css" href="/main.5a06e470202ff93efee3552529750aa4fb751bfcc384826ed98d16d7784e4fdb.css">






<meta itemprop="name" content="Reducing loading times by a tenfold with Postgres aggregations">
<meta itemprop="description" content="Time to market is a very important part of the life of the developers. In the agile world, a team must make a balance between speed and code quality. This does not necessarily mean that the code will not be good nor tested, but sometimes it limits exploration. A limited exploration means that a developer will do things the way he/she is used to.
At least from my experience, SQL is taught in university/courses in an outdated way, where a lot of new features are never explored and people are not aware of this."><meta itemprop="datePublished" content="2021-03-21T12:31:00&#43;01:00" />
<meta itemprop="dateModified" content="2021-03-21T12:31:00&#43;01:00" />
<meta itemprop="wordCount" content="1582"><meta itemprop="image" content="https://devandchill.com/og-image.png"/>
<meta itemprop="keywords" content="postgres,array,aggregations,query,json,performance,optimization," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://devandchill.com/og-image.png"/>

<meta name="twitter:title" content="Reducing loading times by a tenfold with Postgres aggregations"/>
<meta name="twitter:description" content="Time to market is a very important part of the life of the developers. In the agile world, a team must make a balance between speed and code quality. This does not necessarily mean that the code will not be good nor tested, but sometimes it limits exploration. A limited exploration means that a developer will do things the way he/she is used to.
At least from my experience, SQL is taught in university/courses in an outdated way, where a lot of new features are never explored and people are not aware of this."/>








<meta property="article:published_time" content="2021-03-21 12:31:00 &#43;0100 CET" />







<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138171880-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138171880-1');
</script>

    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <img src="/dev-n-chill-logo.svg" alt="Dev &amp; Chill" />
        
    </div>
</a>


        <span class="header__right">
            
            <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/resume">Resume</a></li><li><a href="/posts">Posts</a></li>
    </ul>
</nav>

            <span class="menu-trigger">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M0 0h24v24H0z" fill="none" />
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
            </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
<main class="post">

  <div class="post-info">
    <p>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="feather feather-clock">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      8 minutes

      
    </p>
  </div>

  <article>
    <h1 class="post-title">
      <a href="https://devandchill.com/posts/2021/03/reducing-loading-times-by-a-tenfold-with-postgres-aggregations/">Reducing loading times by a tenfold with Postgres aggregations</a>
    </h1>

    

    

    <div class="post-content">
      <p>Time to market is a very important part of the life of the developers. In the agile world, a team must make a balance between speed and code quality. This does not necessarily mean that the code will not be good nor tested, but sometimes it limits exploration. A limited exploration means that a developer will do things the way he/she is used to.</p>
<p>At least from my experience, SQL is taught in university/courses in an outdated way, where a lot of new features are never explored and people are not aware of this. In 2013, Postgres released version 9.3 which introduced json aggregations, however not a lot of people are aware of this functionality.</p>
<p>In this post, you will see how this can be used to fetch data in 1..N relationships with a single trip to the database.</p>
<h3 id="enter-the-model">Enter the model</h3>
<p>Let&rsquo;s imagine the following model:</p>
<figure>
    <img src="/posts/images/agg_data_model.svg"
         alt="table data model"/> 
</figure>

<p>Populated with the following data:</p>
<p><strong>Table person</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fbab22a3-f7bc-422c-942f-d184ad189e29</td>
<td style="text-align:left">Pablo</td>
</tr>
</tbody>
</table>
<p><strong>Table animal</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>owner_id</th>
<th>type</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>5f2461a9-6c62-453e-9182-38cd0fa76e01</td>
<td>fbab22a3-f7bc-422c-942f-d184ad189e29</td>
<td>cat</td>
<td>Bills</td>
</tr>
</tbody>
</table>
<p><strong>Table vaccine</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0ee28253-5b94-4096-926c-d33ceb22d24d</td>
<td>Feline herpesvirus</td>
</tr>
<tr>
<td>6cf5487a-ba06-42e7-9e80-226590752a77</td>
<td>Rabies</td>
</tr>
</tbody>
</table>
<p><strong>Table animal_vaccine</strong></p>
<table>
<thead>
<tr>
<th>vaccine_id</th>
<th>animal_id</th>
<th>applied_on</th>
</tr>
</thead>
<tbody>
<tr>
<td>0ee28253-5b94-4096-926c-d33ceb22d24d</td>
<td>5f2461a9-6c62-453e-9182-38cd0fa76e01</td>
<td>2021-02-10</td>
</tr>
<tr>
<td>6cf5487a-ba06-42e7-9e80-226590752a77</td>
<td>5f2461a9-6c62-453e-9182-38cd0fa76e01</td>
<td>2022-02-10</td>
</tr>
</tbody>
</table>
<p><a href="https://gist.github.com/pmorelli92/8d93820185bf9eb5142d43f604affd20"><strong>Here you can find the <code>sql</code> script for creating the database and tables with the data listed above.</strong></a></p>
<p>Now, imagine that another service needs to obtain all the people named <code>Pablo</code> with all their pets and the vaccines applied to them. Below you can find different approaches to fetch the required data for creating the required response.</p>
<h3 id="approach-1-many-database-trips">Approach 1: Many database trips</h3>
<ul>
<li>A query will be executed to fetch all the vaccines from such table.</li>
<li>A query will be executed to fetch all the people named <code>Pablo</code>.</li>
<li>For each person filtered, a query will be executed to fetch all the animals that the person owns.</li>
<li>For each animal filtered, a query will be executed to fetch all the vaccines applied on it.</li>
</ul>
<p>This approach is pretty much the one you don&rsquo;t want to have. In code, it is simple to follow, and with some connection pooling you don&rsquo;t have the overhead of creating database connection for each query; however the database trip is still there, and network latency applies. This is also not scalable when you are fetching for example 15 people, as you can see below.</p>
<p>A query to fetch vaccines:</p>
<pre><code>SELECT id, name FROM vaccine
</code></pre><p>A query to fetch people:</p>
<pre><code>SELECT id, name FROM person WHERE name = 'Pablo'
</code></pre><p>15 queries to fetch all the animals a person owns:</p>
<pre><code>SELECT id, type, name FROM animal WHERE owner_id = $1
</code></pre><p>30 trips to fetch vaccines considering that each person may have 2 animals:</p>
<pre><code>SELECT vaccine_id, applied_on FROM animal_vaccine WHERE animal_id = $1
</code></pre><p>A total of 47 trips to the database fetching this information. We can do better than this.</p>
<h3 id="approach-15-less-database-trips">Approach 1.5: Less database trips</h3>
<p>A query will be executed to fetch all the vaccines from such table:</p>
<pre><code>SELECT id, name FROM vaccine
</code></pre><p>A query will be executed to fetch all the people named <code>Pablo</code>:</p>
<pre><code>SELECT id, name FROM person WHERE name = 'Pablo'
</code></pre><p>A query will be executed to fetch all animals whose owner_id is contained on the previous returned list:</p>
<pre><code>SELECT owner_id, id, type, name FROM animal WHERE owner_id IN ($1)
</code></pre><p>A query will be executed to fetch all the vaccines for all the animals returned:</p>
<pre><code>SELECT animal_id, vaccine_id, applied_on FROM animal_vaccine WHERE animal_id IN ($1)
</code></pre><p>This approach is a middle ground, and the main benefit is that the quantity of queries are not related to the amount of data: returning 15 people, will still execute 4 queries.</p>
<p>On the other hand, the code complexity increases as you need a more complex mapping. Note that on the last two queries the <code>owner_id</code> and <code>animal_id</code> need to be retrieved, as the list of animals will be iterated to add each animal to the corresponding owner; and the same happens with the vaccines.</p>
<h3 id="approach-2-how-orm-does-it">Approach 2: How ORM does it</h3>
<p>This is a single query approach, but with one particularity, repeatable data:</p>
<pre><code>SELECT
    p.id,
    p.name,
    a.id AS animal_id,
    a.type,
    a.name,
    v.id AS vaccine_id,
    v.name,
    av.applied_on
FROM person p
LEFT JOIN animal a ON p.id = a.owner_id
LEFT JOIN animal_vaccine av ON av.animal_id = a.id
LEFT JOIN vaccine v ON av.vaccine_id = v.id
WHERE p.name = 'Pablo'
</code></pre><p>Executing the query above will print the following result:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>animal_id</th>
<th>type</th>
<th>name</th>
<th>vaccine_id</th>
<th>name</th>
<th>applied_on</th>
</tr>
</thead>
<tbody>
<tr>
<td>fbab22a3-f7bc-422c-942f-d184ad189e29</td>
<td>Pablo</td>
<td>5f2461a9-6c62-453e-9182-38cd0fa76e01</td>
<td>cat</td>
<td>Bills</td>
<td>0ee28253-5b94-4096-926c-d33ceb22d24d</td>
<td>Feline herpesvirus</td>
<td>2021-02-10</td>
</tr>
<tr>
<td>fbab22a3-f7bc-422c-942f-d184ad189e29</td>
<td>Pablo</td>
<td>5f2461a9-6c62-453e-9182-38cd0fa76e01</td>
<td>cat</td>
<td>Bills</td>
<td>6cf5487a-ba06-42e7-9e80-226590752a77</td>
<td>Rabies</td>
<td>2022-02-10</td>
</tr>
</tbody>
</table>
<p>While generally ORM does the magic mapping behind the scenes and the developer just gets the data aggregated correctly; if a developer wants to map this data manually he/she will need to consider:</p>
<ul>
<li>A person can appear more than once.</li>
<li>An animal can appear more than once.</li>
</ul>
<p>Also, keep attention to the <code>LEFT JOIN</code> here. A person may not have an animal, or an animal may not have any vaccine; enforcing <code>INNER JOIN</code> will cause this data to be filtered out and not appear on the result set.</p>
<p>This approach shows 10 times improvement in comparison to the approach #1, but keep in mind that when returning a lot of columns you will get a lot of repeated data which translates into more network traffic.</p>
<h3 id="approach-3-json-aggregates">Approach 3: Json aggregates</h3>
<p>This approach takes the previous one (keeping the joins) but using json arrays for each of the data points that have a relationship 1 to N with <code>person</code> in order to avoid repeatable rows.</p>
<ul>
<li>A json array for animals (can be more than one)</li>
<li>A json array for animal vaccines (an animal can have one or more than one vaccine)</li>
<li>A json array for vaccines (a person can have N animals and each animal can have N vaccines)</li>
</ul>
<pre><code>SELECT
    p.id,
    p.name,
    json_agg(DISTINCT to_jsonb(a.*)) AS animals,
    json_agg(DISTINCT to_jsonb(av.*)) AS animal_vaccine,
    json_agg(DISTINCT to_jsonb(v.*)) AS vaccine
FROM person p
LEFT JOIN animal a ON p.id = a.owner_id
LEFT JOIN animal_vaccine av ON av.animal_id = a.id
LEFT JOIN vaccine v ON av.vaccine_id = v.id
WHERE p.name = 'Pablo'
GROUP BY p.id, p.name
</code></pre><p>Breaking it:</p>
<pre><code>json_agg(DISTINCT to_jsonb(a.*)) AS animals
</code></pre><p>This will return a json array <code>[...]</code>, on which each row will be returned as a json object (using the column name as json properties) and applying it a <code>DISTINCT</code> to discard repeated results. As we saw on the approach #2, an animal will appear for each vaccine it has received. The distinct filters out that repeated data.</p>
<p>Also the <code>GROUP BY p.id, p.name</code> is used to make sure the person is returned only once as well.</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>animals</th>
<th>animal_vaccine</th>
<th>vaccine</th>
</tr>
</thead>
<tbody>
<tr>
<td>fbab22a3-f7bc-422c-942f-d184ad189e29</td>
<td>Pablo</td>
<td>[{&ldquo;id&rdquo;: &ldquo;5f2461a9-6c62-453e-9182-38cd0fa76e01&rdquo;, &ldquo;name&rdquo;: &ldquo;Bills&rdquo;, &ldquo;type&rdquo;: &ldquo;cat&rdquo;, &ldquo;owner_id&rdquo;: &ldquo;fbab22a3-f7bc-422c-942f-d184ad189e29&rdquo;}]</td>
<td>[{&ldquo;animal_id&rdquo;: &ldquo;5f2461a9-6c62-453e-9182-38cd0fa76e01&rdquo;, &ldquo;applied_on&rdquo;: &ldquo;2021-02-10T00:00:00&rdquo;, &ldquo;vaccine_id&rdquo;: &ldquo;0ee28253-5b94-4096-926c-d33ceb22d24d&rdquo;}, {&ldquo;animal_id&rdquo;: &ldquo;5f2461a9-6c62-453e-9182-38cd0fa76e01&rdquo;, &ldquo;applied_on&rdquo;: &ldquo;2022-02-10T00:00:00&rdquo;, &ldquo;vaccine_id&rdquo;: &ldquo;6cf5487a-ba06-42e7-9e80-226590752a77&rdquo;}]</td>
<td>[{&ldquo;id&rdquo;: &ldquo;0ee28253-5b94-4096-926c-d33ceb22d24d&rdquo;, &ldquo;name&rdquo;: &ldquo;Feline herpesvirus&rdquo;}, {&ldquo;id&rdquo;: &ldquo;6cf5487a-ba06-42e7-9e80-226590752a77&rdquo;, &ldquo;name&rdquo;: &ldquo;Rabies&rdquo;}]</td>
</tr>
</tbody>
</table>
<p>This surely looks messy at first, but you can compare it with the approach #1.5. The mentioned one relied on receiving list of animals and vaccines, but it was a single list for all the people filtered out, in this case the list of animals and vaccines belong to the person on whose row is being iterated.</p>
<p>For each person:</p>
<ul>
<li>Deserialize animals.</li>
<li>Deserialize vaccines.</li>
<li>Deserialize animal vaccines.</li>
</ul>
<p>In golang, these arrays can be represented as <code>[]byte</code> so each one could be used as input for deserializing into a structure with the corresponding fields.</p>
<p>Migrating from approach #1 to approach #3 showed improvements between 10x and 15x.</p>
<h3 id="bonus-approach-doing-the-mapping-on-postgres---but-are-you-sure-you-want-to-do-this">Bonus approach: Doing the mapping on Postgres - but are you sure you want to do this?</h3>
<p>In the approaches above, different ways to fetch data were described, but the mapping ocurred somewhere in the code that executes these queries. Is it possible to do the required mapping using Postgres?</p>
<pre><code>SELECT
    jsonb_build_object(
        'id', p.id,
        'name', p.name,
        'animals', (
            SELECT json_agg(jsonb_build_object(
                'id', a.id,
                'type', a.type,
                'name', a.name,
                'vaccines', (
                    SELECT json_agg(jsonb_build_object(
                        'id', v.id,
                        'name', v.name,
                        'applied_on', av.applied_on
                    ))
                    FROM animal_vaccine av
                    INNER JOIN vaccine v ON av.vaccine_id = v.id
                    WHERE av.animal_id = a.id
                )
            ))
            FROM animal a WHERE a.owner_id = p.id)
    )
FROM person p
WHERE p.name = 'Pablo'
</code></pre><p>And the answer is yes. The query above, uses the function <code>jsonb_build_object</code> for creating a json object with named properties (vs <code>row_to_jsonb</code> which just took the <code>*</code> operator); and the <code>json_agg</code> is used for the relationships that are 1 to N.</p>
<p>For each nested object, a sub query is performed to fetch the relevant data, which gets rid of <code>LEFT JOIN</code> and also <code>GROUP BY</code> (that also gets rid of inherent sorting)</p>
<p>This returns:</p>
<pre><code>{
    &quot;id&quot;: &quot;fbab22a3-f7bc-422c-942f-d184ad189e29&quot;,
    &quot;name&quot;: &quot;Pablo&quot;,
    &quot;animals&quot;: [
        {
            &quot;id&quot;: &quot;5f2461a9-6c62-453e-9182-38cd0fa76e01&quot;,
            &quot;name&quot;: &quot;Bills&quot;,
            &quot;type&quot;: &quot;cat&quot;,
            &quot;vaccines&quot;: [
                {
                    &quot;id&quot;: &quot;0ee28253-5b94-4096-926c-d33ceb22d24d&quot;,
                    &quot;name&quot;: &quot;Feline herpesvirus&quot;,
                    &quot;applied_on&quot;: &quot;2021-02-10T00:00:00&quot;
                },
                {
                    &quot;id&quot;: &quot;6cf5487a-ba06-42e7-9e80-226590752a77&quot;,
                    &quot;name&quot;: &quot;Rabies&quot;,
                    &quot;applied_on&quot;: &quot;2022-02-10T00:00:00&quot;
                }
            ]
        }
    ]
}
</code></pre><p>Postgres, and some other databases, evolved a lot throughout time and are very capable of dealing with json types already. Under certain circumstances a query like the one above can be very useful.</p>
<p>However, keep in mind that doing this could cause the service to have a high coupling between the API model and the database queries; and a change of how you want the response to look like, may affect the way you execute a query.</p>
<h3 id="bottom-line">Bottom line</h3>
<ul>
<li>Postgres is very powerful, it is always useful to keep yourself up to date at least knowing what features are available, even when you don&rsquo;t know the specifics.</li>
<li>Keep in mind simplicity and try to improve as the system requires it.</li>
<li>Do not favor premature optimization just for exploration reasons, but don&rsquo;t be afraid to explore and think out of the box when needed.</li>
</ul>

    </div>
  </article>

  <hr />

  <div class="post-info">
    
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://devandchill.com/tags/postgres/">postgres</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/array/">array</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/aggregations/">aggregations</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/query/">query</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/json/">json</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/performance/">performance</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/optimization/">optimization</a></span>
        
    </p>

    

    <p>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="feather feather-file-text">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      1582 Words
    </p>

    <p>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="feather feather-calendar">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      
      2021-03-21 12:31 &#43;0100
      

      
      
      
    </p>
  </div>
  <hr />
  <div class="sharing-buttons">
    
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;caption=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;canonicalUrl=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;body=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f&amp;media=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f;description=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f&amp;title=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;summary=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;source=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f&amp;resubmit=true&amp;title=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f;title=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations%20https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f&amp;t=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Reducing%20loading%20times%20by%20a%20tenfold%20with%20Postgres%20aggregations&amp;url=https%3a%2f%2fdevandchill.com%2fposts%2f2021%2f03%2freducing-loading-times-by-a-tenfold-with-postgres-aggregations%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

  </div>

  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">Read other posts</span>
      <hr />
    </div>

    <div class="pagination__buttons">
      

      
      <span class="button next">
        <a href="https://devandchill.com/posts/2020/11/the-good-the-bad-and-the-ugly-of-microservices/">
          <span class="button__text">The good, the bad and the ugly of microservices</span>
          <span class="button__icon">â†’</span>
        </a>
      </span>
      
    </div>
  </div>
  

  
  

  
  

</main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
            <span>Pablo Morelli</span><span><a href="https://devandchill.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
