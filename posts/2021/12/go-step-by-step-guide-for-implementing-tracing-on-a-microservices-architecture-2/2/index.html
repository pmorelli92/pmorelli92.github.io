<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Update 2023: The repository with the source code is still having some traction on Github some I decided to update the dependencies as some of them were deprecated and the tracer exporter now uses a different port.
If you just want to jump into the repository with all the code, ðŸ‘‰ check it out here ðŸ‘ˆ This article is the second of a series of two. If you had not read the first one, you can do it here. In this post we are going to finish the implementation of the checkout-service and the stock-service and wrap up the proof of concept.
" />
<meta name="keywords" content="blog, development, programming, tech, go, opentracing, opentelemetry, tracing, telemetry, jaeger" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://devandchill.com/posts/2021/12/go-step-by-step-guide-for-implementing-tracing-on-a-microservices-architecture-2/2/" />


    <title>
        
            Go - Step by step guide for implementing tracing on a microservices architecture (2/2) :: Dev &amp; Chill  â€” A blog about coding
        
    </title>





  <link rel="stylesheet" href="/main.min.281d505ee8507eb85ef5449b3db01c39b07094fe7fedb4f92a730b1d5e143020.css" integrity="sha256-KB1QXuhQfrhe9USbPbAcObBwlP5/7bT5KnMLHV4UMCA=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Go - Step by step guide for implementing tracing on a microservices architecture (2/2)">
  <meta itemprop="description" content="Update 2023: The repository with the source code is still having some traction on Github some I decided to update the dependencies as some of them were deprecated and the tracer exporter now uses a different port.
If you just want to jump into the repository with all the code, ðŸ‘‰ check it out here ðŸ‘ˆ This article is the second of a series of two. If you had not read the first one, you can do it here. In this post we are going to finish the implementation of the checkout-service and the stock-service and wrap up the proof of concept.">
  <meta itemprop="datePublished" content="2021-12-31T16:00:00+02:00">
  <meta itemprop="dateModified" content="2021-12-31T16:00:00+02:00">
  <meta itemprop="wordCount" content="2032">
  <meta itemprop="image" content="https://devandchill.com/og-image.png">
  <meta itemprop="keywords" content="Go,Opentracing,Opentelemetry,Tracing,Telemetry,Jaeger">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://devandchill.com/og-image.png">
  <meta name="twitter:title" content="Go - Step by step guide for implementing tracing on a microservices architecture (2/2)">
  <meta name="twitter:description" content="Update 2023: The repository with the source code is still having some traction on Github some I decided to update the dependencies as some of them were deprecated and the tracer exporter now uses a different port.
If you just want to jump into the repository with all the code, ðŸ‘‰ check it out here ðŸ‘ˆ This article is the second of a series of two. If you had not read the first one, you can do it here. In this post we are going to finish the implementation of the checkout-service and the stock-service and wrap up the proof of concept.">







    <meta property="article:published_time" content="2021-12-31 16:00:00 &#43;0200 &#43;0200" />







    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7X0TBDP4QB"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7X0TBDP4QB');
        }
      </script>



    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <img src="/dev-n-chill-logo.svg" alt="Dev &amp; Chill" />
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">Posts</a></li><li><a href="/resume">Resume</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        10 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://devandchill.com/posts/2021/12/go-step-by-step-guide-for-implementing-tracing-on-a-microservices-architecture-2/2/">Go - Step by step guide for implementing tracing on a microservices architecture (2/2)</a>
      </h1>

      

      

      

      <div class="post-content">
        <p>Update 2023: The repository with the source code is still having some traction on Github some I decided to update the dependencies as some of them were deprecated and the tracer exporter now uses a different port.</p>
<p>If you just want to jump into the repository with all the code, <a href="https://github.com/pmorelli92/open-telemetry-go"  target="_blank" rel="noreferrer noopener" >ðŸ‘‰ check it out here ðŸ‘ˆ</a>
</p>
<hr>
<p>This article is the second of a series of two. If you had not read the first one, <a href="https://devandchill.com/posts/2021/12/go-step-by-step-guide-for-implementing-tracing-on-a-microservices-architecture-1/2/"  target="_blank" rel="noreferrer noopener" >you can do it here.</a>

In this post we are going to finish the implementation of the <code>checkout-service</code> and the <code>stock-service</code> and wrap up the proof of concept.</p>
<h3 id="revisiting-the-flow">Revisiting the flow</h3>
<p>In the previous article we finished with the <code>gateway</code>, and while doing so we defined the <code>proto</code> files required for both <code>gateway</code> and <code>checkout-service</code>. Now, we can tackle the mentioned one and <code>stock-service</code>.</p>
<figure><img src="/posts/images/checkout_user_journey.svg"
    alt="checkout-user-journey">
</figure>

<h3 id="back-to-the-utils-library">Back to the utils library</h3>
<p>Since both <code>checkout</code> and <code>stock</code> are going to use RabbitMQ, there are two functions that can be added in order to simplify the development.</p>
<h4 id="connecting-to-rabbitmq">Connecting to RabbitMQ</h4>
<p>The function below will connect a service to a RabbitMQ instance and declaring, if it does not exist, a default exchange that it is going to be used. Place this function under a new file named <code>amqp.go</code></p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">package</span> utils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/rabbitmq/amqp091-go&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">ConnectAmqp</span><span style="color:#eceff4">(</span>user<span style="color:#eceff4">,</span> pass<span style="color:#eceff4">,</span> host<span style="color:#eceff4">,</span> port <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span>amqp091<span style="color:#eceff4">.</span>Channel<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#81a1c1">error</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	address <span style="color:#81a1c1">:=</span> fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sprintf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;amqp://%s:%s@%s:%s/&#34;</span><span style="color:#eceff4">,</span> user<span style="color:#eceff4">,</span> pass<span style="color:#eceff4">,</span> host<span style="color:#eceff4">,</span> port<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	connection<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> amqp091<span style="color:#eceff4">.</span><span style="color:#88c0d0">Dial</span><span style="color:#eceff4">(</span>address<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	channel<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> connection<span style="color:#eceff4">.</span><span style="color:#88c0d0">Channel</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#eceff4">=</span> channel<span style="color:#eceff4">.</span><span style="color:#88c0d0">ExchangeDeclare</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;exchange&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;direct&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> channel<span style="color:#eceff4">,</span> connection<span style="color:#eceff4">.</span>Close
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>Run <code>go get github.com/rabbitmq/amqp091-go</code> and <code>go mod tidy</code> to ensure the dependencies behave as expected.</p>
<h4 id="propagating-the-trace">Propagating the trace</h4>
<p>When working with HTTP and gRPC calls, the trace can be propagated using go&rsquo;s built-in <code>context</code>, but for RabbitMQ this is not as straightforward. A RabbitMQ message contains both payload and headers, and in this case the headers are an excellent candidate to solve the propagation.</p>
<p>The library <code>rabbitmq/amqp091-go</code> defines the headers as a <code>map[string]interface{}</code>, so we are going to define our own type that is compliance with that:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> AmqpHeadersCarrier <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">interface</span><span style="color:#eceff4">{}</span>
</span></span></code></pre></div><p>The <code>open-telemetry</code> library then will handle the injection and extraction of the trace using the map, but in order to do that our defined type needs to implement the <code>TextMapCarrier</code> interface. This means that the functions <code>Get</code>, <code>Set</code>, and <code>Keys</code> have to be defined.</p>
<p>Create the <code>carriers.go</code> file and add the piece of code below:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">package</span> utils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;go.opentelemetry.io/otel&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> AmqpHeadersCarrier <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">interface</span><span style="color:#eceff4">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>a AmqpHeadersCarrier<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Get</span><span style="color:#eceff4">(</span>key <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">string</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	v<span style="color:#eceff4">,</span> ok <span style="color:#81a1c1">:=</span> a<span style="color:#eceff4">[</span>key<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">!</span>ok <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#a3be8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> v<span style="color:#eceff4">.(</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>a AmqpHeadersCarrier<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Set</span><span style="color:#eceff4">(</span>key <span style="color:#81a1c1">string</span><span style="color:#eceff4">,</span> value <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	a<span style="color:#eceff4">[</span>key<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> value
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>a AmqpHeadersCarrier<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Keys</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">[]</span><span style="color:#81a1c1">string</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	i <span style="color:#81a1c1">:=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span>	r <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">([]</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>a<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> k <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> a <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		r<span style="color:#eceff4">[</span>i<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> k
</span></span><span style="display:flex;"><span>		i<span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> r
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">// InjectAMQPHeaders injects the tracing from the context into the header map</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">InjectAMQPHeaders</span><span style="color:#eceff4">(</span>ctx context<span style="color:#eceff4">.</span>Context<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">interface</span><span style="color:#eceff4">{}</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	h <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span>AmqpHeadersCarrier<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	otel<span style="color:#eceff4">.</span><span style="color:#88c0d0">GetTextMapPropagator</span><span style="color:#eceff4">().</span><span style="color:#88c0d0">Inject</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">,</span> h<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> h
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">// ExtractAMQPHeaders extracts the tracing from the header and puts it into the context</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">ExtractAMQPHeaders</span><span style="color:#eceff4">(</span>ctx context<span style="color:#eceff4">.</span>Context<span style="color:#eceff4">,</span> headers <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">interface</span><span style="color:#eceff4">{})</span> context<span style="color:#eceff4">.</span>Context <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> otel<span style="color:#eceff4">.</span><span style="color:#88c0d0">GetTextMapPropagator</span><span style="color:#eceff4">().</span><span style="color:#88c0d0">Extract</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">,</span> <span style="color:#88c0d0">AmqpHeadersCarrier</span><span style="color:#eceff4">(</span>headers<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>Commit and push these changes so the other services can reference these utilities.</p>
<h3 id="checkout-service">Checkout service</h3>
<p>This component has two responsibilities. First, is going to contain the gRPC server logic, in other words, is going to receive the call from the <code>gateway</code>. Second, is going to publish a RabbitMQ message named <code>checkout.processed</code> that other services may listen to.</p>
<p>In order to do so, these environment variables are needed:</p>
<ul>
<li>JAEGER_ENDPOINT</li>
<li>GRPC_ADDRESS</li>
<li>RABBITMQ_USER</li>
<li>RABBITMQ_PASS</li>
<li>RABBITMQ_HOST</li>
<li>RABBITMQ_PORT</li>
</ul>
<p>Create a folder named <code>checkout</code> and inside initialize go mod and add the dependencies for <code>proto</code>, <code>utils</code> and <code>otelgrpc</code> package (that as stated on the previous article it handles the tracing propagation between gRPC calls):</p>
<pre tabindex="0"><code>go mod init github.com/pmorelli92/open-telemetry-go/checkout
go get github.com/pmorelli92/open-telemetry-go/proto
go get github.com/pmorelli92/open-telemetry-go/utils
go get go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc
</code></pre><p>Then, create the <code>main.go</code> file with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	pb <span style="color:#a3be8c">&#34;github.com/pmorelli92/open-telemetry-go/proto&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/pmorelli92/open-telemetry-go/utils&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/rabbitmq/amqp091-go&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;go.opentelemetry.io/otel&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;go.opentelemetry.io/otel/trace&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;google.golang.org/grpc&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	jaegerEndpoint <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;JAEGER_ENDPOINT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;localhost:4318&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	jaegerPort <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;JAEGER_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;6831&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	grpcAddress <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;GRPC_ADDRESS&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;localhost:8080&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpUser <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_USER&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;guest&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpPass <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_PASS&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;guest&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpHost <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_HOST&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;localhost&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpPort <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;5672&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">SetGlobalTracer</span><span style="color:#eceff4">(</span>context<span style="color:#eceff4">.</span><span style="color:#88c0d0">Background</span><span style="color:#eceff4">(),</span> <span style="color:#a3be8c">&#34;checkout&#34;</span><span style="color:#eceff4">,</span> jaegerAddress<span style="color:#eceff4">,</span> jaegerPort<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatalf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;failed to create tracer: %v&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	channel<span style="color:#eceff4">,</span> closeConn <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">ConnectAmqp</span><span style="color:#eceff4">(</span>amqpUser<span style="color:#eceff4">,</span> amqpPass<span style="color:#eceff4">,</span> amqpHost<span style="color:#eceff4">,</span> amqpPort<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		_ <span style="color:#eceff4">=</span> <span style="color:#88c0d0">closeConn</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	lis<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> net<span style="color:#eceff4">.</span><span style="color:#88c0d0">Listen</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;tcp&#34;</span><span style="color:#eceff4">,</span> grpcAddress<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatalf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;failed to listen: %v&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	s <span style="color:#81a1c1">:=</span> grpc<span style="color:#eceff4">.</span><span style="color:#88c0d0">NewServer</span><span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>		grpc<span style="color:#eceff4">.</span><span style="color:#88c0d0">UnaryInterceptor</span><span style="color:#eceff4">(</span>otelgrpc<span style="color:#eceff4">.</span><span style="color:#88c0d0">UnaryServerInterceptor</span><span style="color:#eceff4">()),</span>
</span></span><span style="display:flex;"><span>		grpc<span style="color:#eceff4">.</span><span style="color:#88c0d0">StreamInterceptor</span><span style="color:#eceff4">(</span>otelgrpc<span style="color:#eceff4">.</span><span style="color:#88c0d0">StreamServerInterceptor</span><span style="color:#eceff4">()))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	pb<span style="color:#eceff4">.</span><span style="color:#88c0d0">RegisterCheckoutServer</span><span style="color:#eceff4">(</span>s<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>server<span style="color:#eceff4">{</span>channel<span style="color:#eceff4">:</span> channel<span style="color:#eceff4">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Printf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;GRPC server listening at %v&#34;</span><span style="color:#eceff4">,</span> lis<span style="color:#eceff4">.</span><span style="color:#88c0d0">Addr</span><span style="color:#eceff4">())</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">:=</span> s<span style="color:#eceff4">.</span><span style="color:#88c0d0">Serve</span><span style="color:#eceff4">(</span>lis<span style="color:#eceff4">);</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatalf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;failed to serve: %v&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> server <span style="color:#81a1c1;font-weight:bold">struct</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	pb<span style="color:#eceff4">.</span>UnimplementedCheckoutServer
</span></span><span style="display:flex;"><span>	channel <span style="color:#81a1c1">*</span>amqp091<span style="color:#eceff4">.</span>Channel
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>So far, the code is doing most of the things needed:</p>
<ul>
<li>Setting up the environment variables and the global tracer.</li>
<li>Connecting to RabbitMQ.</li>
<li>Serving the gRPC server on the provided url.</li>
</ul>
<p>However, this file is lacking the function that specifies how the gRPC checkout function works. This function as stated before, should publish the amqp message:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>s <span style="color:#81a1c1">*</span>server<span style="color:#eceff4">)</span> <span style="color:#88c0d0">DoCheckout</span><span style="color:#eceff4">(</span>ctx context<span style="color:#eceff4">.</span>Context<span style="color:#eceff4">,</span> rq <span style="color:#81a1c1">*</span>pb<span style="color:#eceff4">.</span>CheckoutRequest<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span>pb<span style="color:#eceff4">.</span>CheckoutResponse<span style="color:#eceff4">,</span> <span style="color:#81a1c1">error</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	messageName <span style="color:#81a1c1">:=</span> <span style="color:#a3be8c">&#34;checkout.processed&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Create a new span (child of the trace id) to inform the publishing of the message</span>
</span></span><span style="display:flex;"><span>	tr <span style="color:#81a1c1">:=</span> otel<span style="color:#eceff4">.</span><span style="color:#88c0d0">Tracer</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;amqp&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpContext<span style="color:#eceff4">,</span> messageSpan <span style="color:#81a1c1">:=</span> tr<span style="color:#eceff4">.</span><span style="color:#88c0d0">Start</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">,</span> fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sprintf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;AMQP - publish - %s&#34;</span><span style="color:#eceff4">,</span> messageName<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> messageSpan<span style="color:#eceff4">.</span><span style="color:#88c0d0">End</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Inject the context in the headers</span>
</span></span><span style="display:flex;"><span>	headers <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">InjectAMQPHeaders</span><span style="color:#eceff4">(</span>amqpContext<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	msg <span style="color:#81a1c1">:=</span> amqp<span style="color:#eceff4">.</span>Publishing<span style="color:#eceff4">{</span>Headers<span style="color:#eceff4">:</span> headers<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	err <span style="color:#81a1c1">:=</span> s<span style="color:#eceff4">.</span>channel<span style="color:#eceff4">.</span><span style="color:#88c0d0">PublishWithContext</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;exchange&#34;</span><span style="color:#eceff4">,</span> messageName<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> msg<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">&amp;</span>pb<span style="color:#eceff4">.</span>CheckoutResponse<span style="color:#eceff4">{</span>TotalAmount<span style="color:#eceff4">:</span> <span style="color:#b48ead">1234</span><span style="color:#eceff4">},</span> <span style="color:#81a1c1;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>If our service would publish a lot of messages, this logic for getting a tracer and creating a child span could be isolated on another way, for example using the decorator&rsquo;s <em>pre-processor</em> pattern.</p>
<p>This will do just fine, but tracing allow us to log different things as <em>events</em> for example the response:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>response <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&amp;</span>pb<span style="color:#eceff4">.</span>CheckoutResponse<span style="color:#eceff4">{</span>TotalAmount<span style="color:#eceff4">:</span> <span style="color:#b48ead">1234</span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">// Example on how to log specific events for a span</span>
</span></span><span style="display:flex;"><span>span <span style="color:#81a1c1">:=</span> trace<span style="color:#eceff4">.</span><span style="color:#88c0d0">SpanFromContext</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>span<span style="color:#eceff4">.</span><span style="color:#88c0d0">AddEvent</span><span style="color:#eceff4">(</span>fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sprintf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;response: %v&#34;</span><span style="color:#eceff4">,</span> response<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">return</span> response<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span>
</span></span></code></pre></div><p>Code is then finished, now add a Dockerfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">FROM</span><span style="color:#a3be8c"> golang:alpine3.18 AS compiler</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> apk --update --no-cache add git<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">WORKDIR</span><span style="color:#a3be8c"> /checkout</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ADD</span> go.mod go.sum ./<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> go mod download<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ADD</span> . .<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> CGO_ENABLED<span style="color:#81a1c1">=</span><span style="color:#b48ead">0</span> go build -o /bin/goapp ./main.go<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">FROM</span><span style="color:#a3be8c"> scratch</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">COPY</span> --from<span style="color:#81a1c1">=</span>compiler /bin/goapp /checkout<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ENTRYPOINT</span> <span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;/checkout&#34;</span><span style="color:#eceff4">]</span><span style="color:#bf616a">
</span></span></span></code></pre></div><p>Execute a <code>go mod tidy</code> and you can commit and push.</p>
<h4 id="modifying-the-docker-compose">Modifying the docker-compose</h4>
<p>On the docker-compose file, now add a RabbitMQ instance, and the checkout service:</p>
<pre tabindex="0"><code class="language-docker-compose" data-lang="docker-compose">rabbitmq:
image: &#34;rabbitmq:3-management&#34;
ports:
	- &#34;15672:15672&#34;
	- &#34;5672:5672&#34;
checkout:
build:
	context: checkout
restart: on-failure
ports:
	- &#34;8080:8080&#34;
environment:
    - JAEGER_ENDPOINT=jaeger:4318
	- GRPC_ADDRESS=checkout:8080
	- RABBITMQ_USER=guest
	- RABBITMQ_PASS=guest
	- RABBITMQ_HOST=rabbitmq
	- RABBITMQ_PORT=5672
depends_on:
	- jaeger
	- rabbitmq
</code></pre><h3 id="trying-things-out">Trying things out</h3>
<p>You should be able to start all the components executing from the root of the repository: <code>docker-compose up --build</code>. After the services are up and running you can try calling the gateway with cURL:</p>
<pre tabindex="0"><code>curl -v -X POST http://localhost:8081/api/checkout

&lt; HTTP/1.1 202 Accepted
&lt; Date: Sun, 19 Dec 2021 13:53:04 GMT
&lt; Content-Length: 0
</code></pre><p>The response is <code>202</code> as the <code>checkout-service</code> is up and running, and therefore able to receive the call from the gateway. A trace should be created with 4 spans:</p>
<ul>
<li>HTTP call.</li>
<li>gRPC client call.</li>
<li>gRPC server handling (and logging the response).</li>
<li>AMQP publishing of the message.</li>
</ul>
<p>Go to <code>http://localhost:16686</code>, on the UI select the service <code>gateway</code> and click Find Traces. You should be able to see a trace, click on it to see more details:</p>
<figure><img src="/posts/images/trace-2.png"
    alt="tracing-details">
</figure>

<p>In the previous article, the spans were decorated with a red error logo as the result of the flow was failed (due to the <code>checkout-service</code> not being up). Now there are no warnings or errors indicating that anymore, and we can clearly see the event that was added in the code.</p>
<h3 id="stock-service">Stock service</h3>
<p>This component has only one responsibility that is listening to the <code>checkout.processed</code> message. In order to do so, these environment variables are needed:</p>
<ul>
<li>JAEGER_ENDPOINT</li>
<li>RABBITMQ_USER</li>
<li>RABBITMQ_PASS</li>
<li>RABBITMQ_HOST</li>
<li>RABBITMQ_PORT</li>
</ul>
<p>Create a folder named <code>stock</code> and inside initialize go mod and add the dependency to for <code>utils</code> package:</p>
<pre tabindex="0"><code>go mod init github.com/pmorelli92/open-telemetry-go/stock
go get github.com/pmorelli92/open-telemetry-go/utils
</code></pre><p>Then, create the <code>main.go</code> file with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/pmorelli92/open-telemetry-go/utils&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;github.com/rabbitmq/amqp091-go&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a3be8c">&#34;go.opentelemetry.io/otel&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	jaegerEndpoint <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;JAEGER_ENDPOINT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;localhost:4318&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpUser <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_USER&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;guest&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpPass <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_PASS&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;guest&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpHost <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_HOST&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;localhost&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	amqpPort <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">EnvString</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;RABBITMQ_PORT&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;5672&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">SetGlobalTracer</span><span style="color:#eceff4">(</span>context<span style="color:#eceff4">.</span><span style="color:#88c0d0">Background</span><span style="color:#eceff4">(),</span> <span style="color:#a3be8c">&#34;stock&#34;</span><span style="color:#eceff4">,</span> jaegerEndpoint<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatalf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;failed to create tracer: %v&#34;</span><span style="color:#eceff4">,</span> err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	channel<span style="color:#eceff4">,</span> closeConn <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">ConnectAmqp</span><span style="color:#eceff4">(</span>amqpUser<span style="color:#eceff4">,</span> amqpPass<span style="color:#eceff4">,</span> amqpHost<span style="color:#eceff4">,</span> amqpPort<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		_ <span style="color:#eceff4">=</span> <span style="color:#88c0d0">closeConn</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Create queue and binding</span>
</span></span><span style="display:flex;"><span>	_<span style="color:#eceff4">,</span> err <span style="color:#eceff4">=</span> channel<span style="color:#eceff4">.</span><span style="color:#88c0d0">QueueDeclare</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;stock-queue&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#eceff4">=</span> channel<span style="color:#eceff4">.</span><span style="color:#88c0d0">QueueBind</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;stock-queue&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;checkout.processed&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;exchange&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Start consuming</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#88c0d0">ConsumeFromAMQP</span><span style="color:#eceff4">(</span>channel<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Println</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;AMQP listening&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Block termination</span>
</span></span><span style="display:flex;"><span>	wg <span style="color:#81a1c1">:=</span> sync<span style="color:#eceff4">.</span>WaitGroup<span style="color:#eceff4">{}</span>
</span></span><span style="display:flex;"><span>	wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Add</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Wait</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">ConsumeFromAMQP</span><span style="color:#eceff4">(</span>channel <span style="color:#81a1c1">*</span>amqp<span style="color:#eceff4">.</span>Channel<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>This piece of code is very similar to the <code>checkout-service</code> shown before. This means: parsing environment variables, setting up the tracer and creating an AMQP connection.</p>
<p>The only difference here is that the <code>stock-service</code> is creating a queue (if it does not yet exists) and making this queue receive the <code>checkout.processed</code> message. Then, there is a go routine being executed that will:</p>
<ul>
<li>Receive the amqp message.</li>
<li>Extract the trace and add a span.</li>
<li>Ack the message.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">ConsumeFromAMQP</span><span style="color:#eceff4">(</span>channel <span style="color:#81a1c1">*</span>amqp<span style="color:#eceff4">.</span>Channel<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// Start the consumption</span>
</span></span><span style="display:flex;"><span>	deliveries<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> channel<span style="color:#eceff4">.</span><span style="color:#88c0d0">Consume</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;stock-queue&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;some-tag&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// For each message</span>
</span></span><span style="display:flex;"><span>		d <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>deliveries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// Extract headers</span>
</span></span><span style="display:flex;"><span>		ctx <span style="color:#81a1c1">:=</span> utils<span style="color:#eceff4">.</span><span style="color:#88c0d0">ExtractAMQPHeaders</span><span style="color:#eceff4">(</span>context<span style="color:#eceff4">.</span><span style="color:#88c0d0">Background</span><span style="color:#eceff4">(),</span> d<span style="color:#eceff4">.</span>Headers<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// Create a new span</span>
</span></span><span style="display:flex;"><span>		tr <span style="color:#81a1c1">:=</span> otel<span style="color:#eceff4">.</span><span style="color:#88c0d0">Tracer</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;amqp&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		_<span style="color:#eceff4">,</span> messageSpan <span style="color:#81a1c1">:=</span> tr<span style="color:#eceff4">.</span><span style="color:#88c0d0">Start</span><span style="color:#eceff4">(</span>ctx<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;AMQP - consume - checkout.processed&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// Cannot use defer inside a for loop</span>
</span></span><span style="display:flex;"><span>		time<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sleep</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span> <span style="color:#81a1c1">*</span> time<span style="color:#eceff4">.</span>Millisecond<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		messageSpan<span style="color:#eceff4">.</span><span style="color:#88c0d0">End</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// ACK the message</span>
</span></span><span style="display:flex;"><span>		err <span style="color:#eceff4">=</span> d<span style="color:#eceff4">.</span><span style="color:#88c0d0">Ack</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">false</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>Code is then finished, now add a Dockerfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">FROM</span><span style="color:#a3be8c"> golang:alpine3.18 AS compiler</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> apk --update --no-cache add git<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">WORKDIR</span><span style="color:#a3be8c"> /stock</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ADD</span> go.mod go.sum ./<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> go mod download<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ADD</span> . .<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">RUN</span> CGO_ENABLED<span style="color:#81a1c1">=</span><span style="color:#b48ead">0</span> go build -o /bin/goapp ./main.go<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">FROM</span><span style="color:#a3be8c"> scratch</span><span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">COPY</span> --from<span style="color:#81a1c1">=</span>compiler /bin/goapp /stock<span style="color:#bf616a">
</span></span></span><span style="display:flex;"><span><span style="color:#bf616a"></span><span style="color:#81a1c1;font-weight:bold">ENTRYPOINT</span> <span style="color:#eceff4">[</span><span style="color:#a3be8c">&#34;/stock&#34;</span><span style="color:#eceff4">]</span><span style="color:#bf616a">
</span></span></span></code></pre></div><p>Execute a <code>go mod tidy</code> and you can commit and push.</p>
<h3 id="updating-the-docker-compose">Updating the docker-compose</h3>
<p>Last modification on this file, add the <code>stock-service</code>:</p>
<pre tabindex="0"><code class="language-docker-compose" data-lang="docker-compose">stock:
build:
	context: stock
restart: on-failure
environment:
    - JAEGER_ENDPOINT=jaeger:4318
	- RABBITMQ_USER=guest
	- RABBITMQ_PASS=guest
	- RABBITMQ_HOST=rabbitmq
	- RABBITMQ_PORT=5672
depends_on:
	- jaeger
	- rabbitmq
</code></pre><h3 id="trying-things-out-again">Trying things out, again</h3>
<p>From the root of the repository, run: <code>docker-compose up --build</code>. Invoke the gateway again with cURL:</p>
<pre tabindex="0"><code>curl -v -X POST http://localhost:8081/api/checkout

&lt; HTTP/1.1 202 Accepted
&lt; Date: Sun, 19 Dec 2021 13:53:04 GMT
&lt; Content-Length: 0
</code></pre><p>Go to <code>http://localhost:16686</code>, and find the new trace, it should look like:</p>
<figure><img src="/posts/images/trace-3.png"
    alt="tracing-details">
</figure>

<p>Now, we can see that there is one more span stating that the <code>stock-service</code> consumed the message that was published by the <code>checkout-service</code>.</p>
<h3 id="visualizing-the-journey">Visualizing the journey</h3>
<p>On the Jaeger menu, go to <em>System Architecture</em> and then click on <em>DAG</em>.</p>
<figure><img src="/posts/images/trace-4.png"
    alt="tracing-details">
</figure>

<p>Awesome right? Let&rsquo;s generate more traffic by re-executing the cURL command a couple of times:</p>
<figure><img src="/posts/images/trace-5.png"
    alt="tracing-details">
</figure>

<p>Now, this is a very simple proof of concept, but imagine a real environment, with hundreds of services, having the ability to see who is talking to who, and being able to inspect traces knowing how much time each service took is pretty cool, right?</p>
<h3 id="summary">Summary</h3>
<p>These two articles were code-heavy but I believe that the impact of having a tracing solution is more visible when several components are interacting with each other and using different protocols.</p>
<p>Jaeger, being an open source solution, is a great addition that can help us observe how different components are related, and what flows are they involved into.</p>
<p>Having spans in place, and adding <em>events</em> to them when necessary, can also be a very good replacement for a log solution. The gateway can add the trace id as a response header with <code>span.SpanContext().TraceID()</code> and therefore frontend can show this to the end user.</p>
<p>Finally, users can report an error with a traceable ID on a support channel. Knowing the trace, a developer can use Jaeger UI to see what happened in that user journey and be able to diagnose what happened.</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://devandchill.com/tags/go/">go</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/opentracing/">opentracing</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/opentelemetry/">opentelemetry</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/tracing/">tracing</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/telemetry/">telemetry</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/jaeger/">jaeger</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        2032 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2021-12-31 15:00 &#43;0100
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://devandchill.com/posts/2022/01/set-up-the-same-terminal-regardless-your-os-and-more/">
                    <span class="button__icon">â†</span>
                    <span class="button__text">Set up the same terminal regardless your OS - and more</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://devandchill.com/posts/2021/12/go-step-by-step-guide-for-implementing-tracing-on-a-microservices-architecture-1/2/">
                    <span class="button__text">Go - Step by step guide for implementing tracing on a microservices architecture (1/2)</span>
                    <span class="button__icon">â†’</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        


<script type="text/javascript" src="/bundle.min.d6fc0b7baf099142ae73441220c2ee226564feab1a98908a0e1cfc89cb54302ca08d4be61c21e7bbe0c0daa0879f8f16715660118d1e14b4d323c48ec43f92fe.js" integrity="sha512-1vwLe68JkUKuc0QSIMLuImVk/qsamJCKDhz8ictUMCygjUvmHCHnu&#43;DA2qCHn48WcVZgEY0eFLTTI8SOxD&#43;S/g=="></script>




    </body>
</html>
