<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="One day I was given the task of doing a whiteboard word counter algorithm. The requirements were:
Print on console all the words and the quantity of times they appear on a 40.000 lines input. Make it as fast as possible. For a start one can do it as simple as possible instead, and then try to see whether it can be made faster:
func wordCounter() (words map[string]int) { b, err := ioutil.ReadFile(&#34;input.txt&#34;) if err != nil { log.Fatal(err) } removeLineBreaks := regexp.MustCompile(`\r?\n`) inputText := removeLineBreaks.ReplaceAllString(string(b),&#34; &#34;) words = make(map[string]int) removeSpecial := regexp.MustCompile(`(?m)[^a-z]`) for _, w := range strings.Split(inputText, &#34; &#34;) { w = strings.ToLower(w) w = removeSpecial.ReplaceAllString(w, &#34;&#34;) if w != &#34;&#34; { words[w]&#43;&#43; } } return } What the code does is the following:
" />
<meta name="keywords" content="blog, development, programming, tech, golang, go, sync, concurrent, streams, channels" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://devandchill.com/posts/2019/04/word-counter-sync-concurrent-or-streams/" />


    <title>
        
            Word counter: Sync, concurrent or streams? :: Dev &amp; Chill  â€” A blog about coding
        
    </title>





  <link rel="stylesheet" href="/main.min.281d505ee8507eb85ef5449b3db01c39b07094fe7fedb4f92a730b1d5e143020.css" integrity="sha256-KB1QXuhQfrhe9USbPbAcObBwlP5/7bT5KnMLHV4UMCA=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Word counter: Sync, concurrent or streams?">
  <meta itemprop="description" content="One day I was given the task of doing a whiteboard word counter algorithm. The requirements were:
Print on console all the words and the quantity of times they appear on a 40.000 lines input. Make it as fast as possible. For a start one can do it as simple as possible instead, and then try to see whether it can be made faster:
func wordCounter() (words map[string]int) { b, err := ioutil.ReadFile(&#34;input.txt&#34;) if err != nil { log.Fatal(err) } removeLineBreaks := regexp.MustCompile(`\r?\n`) inputText := removeLineBreaks.ReplaceAllString(string(b),&#34; &#34;) words = make(map[string]int) removeSpecial := regexp.MustCompile(`(?m)[^a-z]`) for _, w := range strings.Split(inputText, &#34; &#34;) { w = strings.ToLower(w) w = removeSpecial.ReplaceAllString(w, &#34;&#34;) if w != &#34;&#34; { words[w]&#43;&#43; } } return } What the code does is the following:">
  <meta itemprop="datePublished" content="2019-04-10T20:59:47+02:00">
  <meta itemprop="dateModified" content="2019-04-10T20:59:47+02:00">
  <meta itemprop="wordCount" content="1275">
  <meta itemprop="image" content="https://devandchill.com/og-image.png">
  <meta itemprop="keywords" content="Golang,Go,Sync,Concurrent,Streams,Channels">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://devandchill.com/og-image.png">
  <meta name="twitter:title" content="Word counter: Sync, concurrent or streams?">
  <meta name="twitter:description" content="One day I was given the task of doing a whiteboard word counter algorithm. The requirements were:
Print on console all the words and the quantity of times they appear on a 40.000 lines input. Make it as fast as possible. For a start one can do it as simple as possible instead, and then try to see whether it can be made faster:
func wordCounter() (words map[string]int) { b, err := ioutil.ReadFile(&#34;input.txt&#34;) if err != nil { log.Fatal(err) } removeLineBreaks := regexp.MustCompile(`\r?\n`) inputText := removeLineBreaks.ReplaceAllString(string(b),&#34; &#34;) words = make(map[string]int) removeSpecial := regexp.MustCompile(`(?m)[^a-z]`) for _, w := range strings.Split(inputText, &#34; &#34;) { w = strings.ToLower(w) w = removeSpecial.ReplaceAllString(w, &#34;&#34;) if w != &#34;&#34; { words[w]&#43;&#43; } } return } What the code does is the following:">







    <meta property="article:published_time" content="2019-04-10 20:59:47 &#43;0200 CEST" />







    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7X0TBDP4QB"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7X0TBDP4QB');
        }
      </script>



    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <img src="/dev-n-chill-logo.svg" alt="Dev &amp; Chill" />
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">Posts</a></li><li><a href="/resume">Resume</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        6 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://devandchill.com/posts/2019/04/word-counter-sync-concurrent-or-streams/">Word counter: Sync, concurrent or streams?</a>
      </h1>

      

      

      

      <div class="post-content">
        <p>One day I was given the task of doing a whiteboard <code>word counter</code> algorithm. The requirements were:</p>
<ul>
<li>Print on console all the words and the quantity of times they appear on a 40.000 lines input.</li>
<li>Make it as fast as possible.</li>
</ul>
<p>For a start one can do it as simple as possible instead, and then try to see whether it can be made faster:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">wordCounter</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">(</span>words <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	b<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> ioutil<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReadFile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;input.txt&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	removeLineBreaks <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`\r?\n`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	inputText <span style="color:#81a1c1">:=</span> removeLineBreaks<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">(</span>b<span style="color:#eceff4">),</span><span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	words <span style="color:#eceff4">=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	removeSpecial <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`(?m)[^a-z]`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> _<span style="color:#eceff4">,</span> w <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">Split</span><span style="color:#eceff4">(</span>inputText<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		w <span style="color:#eceff4">=</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>w<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		w <span style="color:#eceff4">=</span> removeSpecial<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span>w<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> w <span style="color:#81a1c1">!=</span> <span style="color:#a3be8c">&#34;&#34;</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			words<span style="color:#eceff4">[</span>w<span style="color:#eceff4">]</span><span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>What the code does is the following:</p>
<ol>
<li>Read the file, remove the line breaks and put it on a string variable.</li>
<li>Create the map structure that will hold a key (word) and a value (quantity)</li>
<li>Create a regular expression for removing punctuation characters like <code>, ! ?</code></li>
<li>For each word in the text (splitting by spaces)</li>
<li>Lowercase it + execute the regex + add 1 to the map quantity for that word.</li>
<li>When we finish, we print to the console.</li>
</ol>
<p>This works fine, but we are using Go and every post describing Go talks about <code>goroutines</code> and how easy is to achieve concurrency. So what the code is changed to the following?</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Println</span><span style="color:#eceff4">(</span><span style="color:#88c0d0">wordCounterConcurrent</span><span style="color:#eceff4">())</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">wordCounterConcurrent</span><span style="color:#eceff4">()</span> <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	b<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> ioutil<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReadFile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;input.txt&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	removeLineBreaks <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`\r?\n`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	inputText <span style="color:#81a1c1">:=</span> removeLineBreaks<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">(</span>b<span style="color:#eceff4">),</span><span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	words <span style="color:#eceff4">=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	removeSpecial <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`(?m)[^a-z]`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	wg <span style="color:#81a1c1">:=</span> sync<span style="color:#eceff4">.</span>WaitGroup<span style="color:#eceff4">{}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> _<span style="color:#eceff4">,</span> w <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">Split</span><span style="color:#eceff4">(</span>inputText<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Add</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">(</span>w2 <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">defer</span> wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Done</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>			w2 <span style="color:#eceff4">=</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>w2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			w2 <span style="color:#eceff4">=</span> removeSpecial<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span>w2<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			words<span style="color:#eceff4">[</span>w2<span style="color:#eceff4">]</span><span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}(</span>w<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Wait</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> mostFrequent
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>The differences in this snippet and the first one are the following:</p>
<ol>
<li>We defined a <code>WaitGroup</code> that will allow us to:
<ul>
<li>Add a counter every time a goroutine is fired.</li>
<li>Block the main goroutine with the <code>wg.Wait()</code> until all the other goroutines are finished.</li>
<li><em>Decrease</em> the counter executing <code>wg.Done()</code> every time a goroutine is finished.</li>
</ul>
</li>
<li>We put the functionality that is going to be executed for each word in an <code>anonymous function</code>. So now, we can use the word <code>go</code> to execute that function in a different goroutine.</li>
</ol>
<p>Does this work? Unfortunately no. If we execute the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; go run main.go --race
</span></span><span style="display:flex;"><span>fatal error: concurrent map <span style="color:#81a1c1">read</span> and map write
</span></span></code></pre></div><p>Basically the race detector is telling us that some of the goroutines can execute this line at the same moment:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>words<span style="color:#eceff4">[</span>w2<span style="color:#eceff4">]</span><span style="color:#81a1c1">++</span>
</span></span></code></pre></div><p>If the map does not want to be written at the same time by two different goroutines we should use some sort of <code>queue</code> and then consume the values in a single threaded process. Fortunately, Go have us covered with <code>channels</code>.</p>
<p>Doing the following modifications should work:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Println</span><span style="color:#eceff4">(</span><span style="color:#88c0d0">wordCounterConcurrent</span><span style="color:#eceff4">())</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">wordCounterConcurrent</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">(</span>words <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	b<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> ioutil<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReadFile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;input.txt&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	removeLineBreaks <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`\r?\n`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	inputText <span style="color:#81a1c1">:=</span> removeLineBreaks<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">(</span>b<span style="color:#eceff4">),</span><span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	words <span style="color:#eceff4">=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	removeSpecial <span style="color:#81a1c1">:=</span> regexp<span style="color:#eceff4">.</span><span style="color:#88c0d0">MustCompile</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">`(?m)[^a-z]`</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	doneChan <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">bool</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	wordsChan <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> w <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>wordsChan<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>				words<span style="color:#eceff4">[</span>w<span style="color:#eceff4">]</span><span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>doneChan<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>				<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	wg <span style="color:#81a1c1">:=</span> sync<span style="color:#eceff4">.</span>WaitGroup<span style="color:#eceff4">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> _<span style="color:#eceff4">,</span> w <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1;font-weight:bold">range</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">Split</span><span style="color:#eceff4">(</span>inputText<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34; &#34;</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Add</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">(</span>w1 <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">defer</span> wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Done</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>			w1 <span style="color:#eceff4">=</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>w1<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			w1 <span style="color:#eceff4">=</span> removeSpecial<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span>w1<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">if</span> w1 <span style="color:#81a1c1">!=</span> <span style="color:#a3be8c">&#34;&#34;</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>				wordsChan <span style="color:#81a1c1">&lt;-</span> w1
</span></span><span style="display:flex;"><span>			<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}(</span>w<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Wait</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	doneChan <span style="color:#81a1c1">&lt;-</span> <span style="color:#81a1c1;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>But now the code growth a lot, lets look at it by parts:</p>
<p>In order to declare channels the following syntax is required:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>doneChan <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">bool</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>wordsChan <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">chan</span> <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span>
</span></span></code></pre></div><p>Now, the words goroutines instead of performing operations using the map is just pushing a value into a channel.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>wordsChan <span style="color:#81a1c1">&lt;-</span> w1
</span></span></code></pre></div><p>The operations using the map, then will be performed when a value is read from the channel (blocking action since it is not a buffered channel)</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">go</span> <span style="color:#81a1c1;font-weight:bold">func</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">select</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">case</span> w <span style="color:#81a1c1">:=</span> <span style="color:#81a1c1">&lt;-</span>wordsChan<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>			words<span style="color:#eceff4">[</span>w<span style="color:#eceff4">]</span><span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">case</span> <span style="color:#81a1c1">&lt;-</span>doneChan<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}()</span>
</span></span></code></pre></div><p>This piece of code will read from the <code>wordsChannel</code> and perform the map operation; and also read from the <code>doneChannel</code> to stop the goroutine.</p>
<p>The message to the <code>doneChannel</code> will only be submitted after all words goroutines are finished.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>wg<span style="color:#eceff4">.</span><span style="color:#88c0d0">Wait</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>doneChan <span style="color:#81a1c1">&lt;-</span> <span style="color:#81a1c1;font-weight:bold">true</span>
</span></span></code></pre></div><p>Now if we run this algorithm we will see that is not failing anymore. Letâ€™s then move to benchmarking.</p>
<h2 id="benchmark">Benchmark</h2>
<p>We are going to do this in two different ways: executing the idiomatic Go benchmark and using the command-line utility <code>time</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; go <span style="color:#81a1c1">test</span> -run<span style="color:#81a1c1">=</span>XXX -bench<span style="color:#81a1c1">=</span>.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BenchmarkWordCounter-12               <span style="color:#b48ead">45</span>   25.88 ms/op   <span style="color:#b48ead">4354027</span> B/op   <span style="color:#b48ead">124918</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWordCounterConcurrent-12     <span style="color:#b48ead">19</span>   59.70 ms/op   <span style="color:#b48ead">5711640</span> B/op   <span style="color:#b48ead">138290</span> allocs/op
</span></span></code></pre></div><p>This is telling us that the sync version executed <code>45 times</code> and each execution took approx <code>25.88 milliseconds</code>, meanwhile in the same time the concurrent version only got executed <code>19 times</code> because each execution took approx <code>59.70 milliseconds</code>.</p>
<p>Wait, What?</p>
<p>Let&rsquo;s try the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; go build
</span></span><span style="display:flex;"><span>&gt; <span style="color:#81a1c1">time</span> ./go-word-counter
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#81a1c1">(</span>SYNC<span style="color:#81a1c1">)</span>
</span></span><span style="display:flex;"><span>./go-word-counter  0.04s user 0.00s system 89% cpu 0.050 total
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">(</span>CONCURRENT<span style="color:#81a1c1">)</span>
</span></span><span style="display:flex;"><span>./go-word-counter  0.46s user 0.13s system 486% cpu 0.120 total
</span></span></code></pre></div><p>So the sync version takes approx <code>0.050</code> and <code>89% cpu</code> and the concurrent one <code>0.120</code> and <code>486% cpu</code>.</p>
<p>We are sure that the function is running concurrently (hence the CPU usage), but shouldn&rsquo;t that mean it has to run faster? Well, no.</p>
<p>Looking at the code one can see that the parts that get executed inside the word goroutines takes less to execute than all the orchestration needed for pulling a word from a channel.</p>
<p>Things would be different if an sleep was added:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>w1 <span style="color:#eceff4">=</span> strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>w1<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>w1 <span style="color:#eceff4">=</span> removeSpecial<span style="color:#eceff4">.</span><span style="color:#88c0d0">ReplaceAllString</span><span style="color:#eceff4">(</span>w1<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>time<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sleep</span><span style="color:#eceff4">(</span><span style="color:#b48ead">200</span><span style="color:#eceff4">)</span>
</span></span></code></pre></div><p>And then the benchmark:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BenchmarkWordCounter-12                <span style="color:#b48ead">3</span>   425.23 ms/op   <span style="color:#b48ead">4436128</span> B/op   <span style="color:#b48ead">124934</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWordCounterConcurrent-12     <span style="color:#b48ead">19</span>    64.75 ms/op   <span style="color:#b48ead">8812324</span> B/op   <span style="color:#b48ead">179560</span> allocs/op
</span></span></code></pre></div><p>In this scenario is visible how the concurrent way outperforms the sync one.</p>
<p>So we started with a single goroutine algorithm, we evolved it to run using more than one goroutine and having an orchestration for the algorithm to work. At the end we did a benchmark and compared the results.</p>
<p>The value we can get out of this is to avoid <code>premature optimization</code>, how to <code>KISS</code> (keep it simple and stupid) and the most important one: We learned that concurrent flows are beneficial when the code inside the goroutine is CPU/time intensive.</p>
<h2 id="2020-edit">2020 Edit</h2>
<p>One alternative suggested by <a href="https://github.com/Xeoncross"  target="_blank" rel="noreferrer noopener" >David Pennington</a>
 was to use streams instead of loading the whole file to the disk. In this case the code will look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">wordCounterStream</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">(</span>words <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	file<span style="color:#eceff4">,</span> err <span style="color:#81a1c1">:=</span> os<span style="color:#eceff4">.</span><span style="color:#88c0d0">Open</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;input.txt&#34;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">defer</span> file<span style="color:#eceff4">.</span><span style="color:#88c0d0">Close</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	words <span style="color:#eceff4">=</span> <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	scanner <span style="color:#81a1c1">:=</span> bufio<span style="color:#eceff4">.</span><span style="color:#88c0d0">NewScanner</span><span style="color:#eceff4">(</span>file<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// bufio.ScanWords includes punctuation that we want to remove</span>
</span></span><span style="display:flex;"><span>	<span style="color:#616e87;font-style:italic">// reimplemented that method checking with unicode.IsPunct</span>
</span></span><span style="display:flex;"><span>	scanner<span style="color:#eceff4">.</span><span style="color:#88c0d0">Split</span><span style="color:#eceff4">(</span>ScanWords<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">for</span> scanner<span style="color:#eceff4">.</span><span style="color:#88c0d0">Scan</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		w <span style="color:#81a1c1">:=</span> scanner<span style="color:#eceff4">.</span><span style="color:#88c0d0">Text</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">if</span> w <span style="color:#81a1c1">!=</span> <span style="color:#a3be8c">&#34;&#34;</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			words<span style="color:#eceff4">[</span>strings<span style="color:#eceff4">.</span><span style="color:#88c0d0">ToLower</span><span style="color:#eceff4">(</span>w<span style="color:#eceff4">)]</span><span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> err <span style="color:#81a1c1">:=</span> scanner<span style="color:#eceff4">.</span><span style="color:#88c0d0">Err</span><span style="color:#eceff4">();</span> err <span style="color:#81a1c1">!=</span> <span style="color:#81a1c1;font-weight:bold">nil</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		log<span style="color:#eceff4">.</span><span style="color:#88c0d0">Fatal</span><span style="color:#eceff4">(</span>err<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><ul>
<li>Open the file which contains the words.</li>
<li>Create a new scanner for the stream.</li>
<li>Make the scanner split the stream on the criteria selected.</li>
<li>Each split obtained represents a word.</li>
</ul>
<p>The <code>scanner.Split(...)</code> instead of using <code>bufio.ScanWords</code> is using an implementation that takes care of splitting the words when punctuation happens since the default implementation do not consider these cases. This can be found on my repository linked below.</p>
<p>Now the benchmarks demonstrate what a better solution for this problem would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>benchmark                           iter     time/iter    bytes alloc             allocs
</span></span><span style="display:flex;"><span>---------                           ----     ---------    -----------             ------
</span></span><span style="display:flex;"><span>BenchmarkWordCounter-12               <span style="color:#b48ead">45</span>   25.88 ms/op   <span style="color:#b48ead">4354027</span> B/op   <span style="color:#b48ead">124918</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWordCounterConcurrent-12     <span style="color:#b48ead">19</span>   59.70 ms/op   <span style="color:#b48ead">5711640</span> B/op   <span style="color:#b48ead">138290</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWordCounterStreams-12       <span style="color:#b48ead">198</span>    5.93 ms/op    <span style="color:#b48ead">330114</span> B/op    <span style="color:#b48ead">44844</span> allocs/op
</span></span></code></pre></div><p>ðŸ‘‰ <a href="https://github.com/pmorelli92/go-word-counter"  target="_blank" rel="noreferrer noopener" >Repository with source files used</a>
 ðŸ‘ˆ</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://devandchill.com/tags/golang/">golang</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/go/">go</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/sync/">sync</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/concurrent/">concurrent</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/streams/">streams</a></span>
        <span class="tag"><a href="https://devandchill.com/tags/channels/">channels</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1275 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2019-04-10 20:59 &#43;0200
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://devandchill.com/posts/2019/06/sign-github-commits-using-mac/">
                    <span class="button__icon">â†</span>
                    <span class="button__text">Sign GitHub commits (using Mac)</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://devandchill.com/posts/2019/03/go-modules-working-outside-gopath/">
                    <span class="button__text">Go Modules: Working outside GOPATH</span>
                    <span class="button__icon">â†’</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        


<script type="text/javascript" src="/bundle.min.d6fc0b7baf099142ae73441220c2ee226564feab1a98908a0e1cfc89cb54302ca08d4be61c21e7bbe0c0daa0879f8f16715660118d1e14b4d323c48ec43f92fe.js" integrity="sha512-1vwLe68JkUKuc0QSIMLuImVk/qsamJCKDhz8ictUMCygjUvmHCHnu&#43;DA2qCHn48WcVZgEY0eFLTTI8SOxD&#43;S/g=="></script>




    </body>
</html>
